<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  
  <title>第 2 页 | 綮地</title>
  <meta name="author" content="李鹏超">
  
  <meta name="description" content="新手一枚">
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="綮地"/>

  
    <meta property="og:image" content=""/>
  

  <link rel="shortcut icon" href="/favicon.png">
  
  
<link rel="stylesheet" href="/css/style.css">

  <!--[if lt IE 9]><script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script><![endif]-->
  

<meta name="generator" content="Hexo 5.2.0"></head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">綮地</a></h1>
  <h2><a href="/"></a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/null">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
  <article id="post-前三天" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2020-11-06T13:13:12.143Z"><a href="/2020/11/06/%E5%89%8D%E4%B8%89%E5%A4%A9/">2020-11-06</a></time>
      
      
  
    <h1 class="title"><a href="/2020/11/06/%E5%89%8D%E4%B8%89%E5%A4%A9/">第一周</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <p>一、First</p>
<blockquote>
<p>1.基本命令</p>
</blockquote>
<pre><code>[root@ruozedata001 ~]# 
root用户  管理员 最大权限
ruozedata001 
~ 当前该用户的 家目录 </code></pre>
<blockquote>
<p>2.pwd 查看当前光标所在的目录(路径 path)</p>
</blockquote>
<pre><code>[root@ruozedata001 ~]# pwd
/root
/代表根
/房间/柜子/箱子
根目录\root</code></pre>
<blockquote>
<p>3.ls 查看</p>
</blockquote>
<pre><code>ls 显示的 文件夹  文件的名称
ls -l 权限 用户用户组 时间 大小
==》ll 等价
ls -l -a 显示隐藏文件和文件夹  ll -als -la
[root@ruozedata001 ~]# ls -l -a
total 56
-rw-------.  1 root root 15031 Nov  4 21:59 .bash_history
-rw-r--r--.  1 root root    18 Dec 29  2013 .bash_logout
-rw-r--r--   1 root root   322 May 27 12:32 .bash_profile
-rw-r--r--   1 root root   176 May 27 12:30 .bashrc
drwx------   3 root root16 Feb 28  2020 .cache

以.开头的文件或者文件夹就叫 隐藏文件夹

ls -l -h 仅仅查看文件的大小 ll -h   ls -lh
ls -l -r -t  按时间排序等价于ll -rt  ls -lrt  加r反序
order  time</code></pre>
<blockquote>
<p>4.mkdir 创建文件夹</p>
</blockquote>
<pre><code>mkdir 1 2 3 并联创建文件夹
mkdir -p 4/5/6  串联创建文件夹  级联 </code></pre>
<blockquote>
<p>5.cd 切换目录 </p>
</blockquote>
<pre><code>/根目录
cd dir 切换到指定目录
cd ../退回上一层目录
cd ../../退回上2层目录
cd ../../../退回上3层目录

家目录
cd /root  家目录路径补全 
cd 直接回车  J哥推荐的
cd ~
cd ~/1
cd - 回退到上一次命令  </code></pre>
<blockquote>
<p>6.目录(路径)</p>
</blockquote>
<pre><code>绝对目录  /根目录开头  路径是齐全的 
相对目录  不是以/开头  路径是短的
[root@ruozedata001 ~]# cd 1
[root@ruozedata001 1]# cd ../
[root@ruozedata001 ~]# 
[root@ruozedata001 ~]# cd /root/1
[root@ruozedata001 1]# 
[root@ruozedata001 1]# cd ../4/5</code></pre>
<blockquote>
<p> 7.命令帮助 help</p>
</blockquote>
<pre><code>[root@ruozedata001 ~]# ls --help
Usage: ls [OPTION]... [FILE]...

[ ] 可选项
[root@ruozedata001 ~]# mkdir --help
Usage: mkdir [OPTION]... DIRECTORY...
Create the DIRECTORY(ies), if they do not already exist.

man 命令（这个命令更复杂）
会显示出详细的命令解释</code></pre>
<p>二、Second</p>
<blockquote>
<p>1.clear 清理屏幕</p>
</blockquote>
<blockquote>
<p>2.mv移动 cp复制</p>
</blockquote>
<pre><code>mv 始终是一份  快
cp 两份慢
[root@ruozedata001 ~]# mv jepson 1
[root@ruozedata001 ~]# cp  jepson2  1
cp: omitting directory ‘jepson2’
[root@ruozedata001 ~]# 

文件夹
 cp -r jepson2  1   非标
 cp -r jepson2  1/jepson2   标准操作 
 cp -r jepson3  1/jepson33  修改名称的

 mv jepson  1   非标
 mv jepson  1/jepson标准操作 
 mv jepson4 1/jepson44  修改名称的</code></pre>
<blockquote>
<p>3.创建文件</p>
</blockquote>
<pre><code>创建一个空文件
touch  1.log  【J哥推荐】
vi  2.log
默认进入命令行模式
i键  进入命令行模式--》编辑模式  
esc键从编辑模式--》命令行模式
shift+:  从命令行模式--》尾行模式。输入wq保存退出
cat /dev/null &gt; 3.log   清空文件内容 为空文件【推荐】
echo &quot;&quot; &gt; 4.log   【慎用】
[root@ruozedata001 ~]# ll
total 12
-rw-r--r-- 1 root root   0 Nov  7 20:24 1.log
-rw-r--r-- 1 root root  18 Nov  7 20:28 2.log
-rw-r--r-- 1 root root   0 Nov  7 20:30 3.log
-rw-r--r-- 1 root root   1 Nov  7 20:31 4.log
-rw-r--r-- 1 root root 203 Nov  7 20:31 ruoze2.log
-rw-r--r-- 1 root root   0 Nov  7 20:26 ruoze.log

先清理内容 再判断是否为空，
假如为空就继续执行脚本内容
否则退出 
&gt;  将文本内容 覆盖掉   【高危命令1】
cp mysql.cnf  mysql.cnf20201107  养成备份的好习惯
&gt;&gt; 将文本内容 追加</code></pre>
<blockquote>
<p>4.查看文件内容</p>
</blockquote>
<pre><code>cat 文件内容一下子全部显示  ctrl+z中断【推荐】 适合内容少的，内容多 不适合
more 文件内容一页页 往下翻，按空格往下翻，ctrl+b回退  q退出 【推荐】适合内容多的 
less 文件内容 按键盘的上下键  按行为单位  q退出

tail 实时查看文件内容
-f   假如文件被移除 然后重命名 就无法再监控到文件
-F   假如文件被移除 然后重命名 会不断的retry尝试 去监控文件，直到监控到位
-f, --follow[=&#123;name|descriptor&#125;]
output appended data as the file grows;
an absent option argument means &#39;descriptor&#39;
-F   same as --follow=name --retry

log4j  日志组件 以下流程说的是每写满100M文件，mv移动更名之后，继续在原大小为0的文件中写
   规则： 大小为100M，保留10份
   erp.log
           mv erp.log erp.log1
           touch erp.log

   erp.log  空的---》100m
   erp.log1 100m
            mv erp.log erp.log2
            touch erp.log

   erp.log  空的
   erp.log1 100m
   erp.log2 100m

项目踩的坑
log---&gt;flume--&gt;kafka   tail查看文件用-F F相比于f有重试机制

想要查看文件内容倒数100行，且实时监控
tail -100f 1.log

文件内容特别多 如何快速定位到ERROR、关键词信息
cat CloudAgent.log | grep ERROR
cat CloudAgent.log | grep -A 10 ERROR 后10行
cat CloudAgent.log | grep -B 10 ERROR 前10行
cat CloudAgent.log | grep -C 10 ERROR 前后各10行 20行 【推荐】
| 管道符
grep过滤

比如 ERROR 很多 成千上万 【推荐】
cat CloudAgent.log | grep -C 20 ERROR &gt; 20201107error.log
more 20201107error.log

通过编辑去搜索
    vi xxx.log
    shift+:
    /ERROR 回车
    n键寻找 
将日志文件 下载到window电脑，进行搜索 定位 分析  【推荐】
坑: 假如CloudAgent.log 原文件很大，那么从生产下载到公司网络 是不是要走外网带宽10M的，
想问 会不会影响 公司服务？
建议： 假如下载大文件，业务高峰或者工作日白天 尽量不要做，非要做，那就【限速】（FTP）</code></pre>
<blockquote>
<p>5.上传下载</p>
</blockquote>
<pre><code>yum install -y lrzsz
sz xxx.log 下载 Linux--》window
rz 直接回车 相反的</code></pre>
<blockquote>
<p>6.别名 alias</p>
</blockquote>
<pre><code>ls -l ==&gt;ll 
未来生产上 常用的命令 或 复杂的命令 一串，可以使用别名 来简化
[root@ruozedata001 ~]# alias jlog=&#39;cd /var/log&#39;
[root@ruozedata001 ~]# 
[root@ruozedata001 ~]# 
[root@ruozedata001 ~]# pwd
/root
[root@ruozedata001 ~]# jlog
[root@ruozedata001 log]# pwd
/var/log
[root@ruozedata001 log]# 

[root@ruozedata001 ~]# jlog
-bash: jlog: command not found   【错误1】
[root@ruozedata001 ~]#   
没有设置全局生效</code></pre>
<blockquote>
<p>7.环境变量</p>
</blockquote>
<pre><code>全局：/etc/profile 
source /etc/profile //当前会话生效 ，已经开启的会话不会跟着自动生效，需要重新执行生效命令,新开的会话是自动的生效 
个人：~/.bash_profile 
~/.bashrc  【推荐】

[root@ruozedata001 ~]# source .bash_profile 
[root@ruozedata001 ~]# . .bash_profile 

  场景：
  ssh 远程执行B机器 启动服务命令 抛错， java command not found 
  直接登录B机器 命令是找到的  which java找到

  配置环境变量文件在 .bash_profile 是不正确的，应该配置在 .bashrc文件里。
  https://blog.csdn.net/whitehack/article/details/51705889</code></pre>
<blockquote>
<p>8.创建用户和设置密码</p>
</blockquote>
<pre><code>[root@ruozedata001 ~]# useradd jj
[root@ruozedata001 ~]# id jj
uid=1005(jj) gid=1006(jj) groups=1006(jj)
[root@ruozedata001 ~]# passwd jj
Changing password for user jj.
New password: 
BAD PASSWORD: The password is shorter than 8 characters
Retype new password: 
passwd: all authentication tokens updated successfully.
[root@ruozedata001 ~]# </code></pre>
<blockquote>
<p>9.tab</p>
</blockquote>
<pre><code>按一次 匹配只有一串的 就补齐这串
按2次 打印出匹配的所有字符</code></pre>
<blockquote>
<p>10.历史命令 history</p>
</blockquote>
<pre><code>alias ll=&#39;rm -rf /*&#39;
[root@ruozedata001 ~]# !999  执行
cd /var/log/
[root@ruozedata001 log]#
[root@ruozedata001 log]# history -c  清空</code></pre>
<p>三、third </p>
<blockquote>
<p>1.rm 删除 【高危命令2】</p>
</blockquote>
<pre><code>rm -rf /
rm xxx.log
rm -r yyydir
-f 直接不提示 直接删除 
脚本场景：
业务逻辑判断 赋值的 LOG_PATH=/xxx/yyy
漏了一种没有赋值
rm -rf $&#123;LOG_PATH&#125;/*  ==&gt; rm -rf /* 
如何避免：
每次删除之前，都判断$&#123;LOG_PATH&#125;目录是否存在,还有此值不为空
set -u参数  在脚本的 第一行#!/bin/bash ,在第二行写</code></pre>
<blockquote>
<p>2.用户用户组</p>
</blockquote>
<pre><code>[root@ruozedata001 ~]# ll /usr/sbin/user*
-rwxr-x--- 1 root root 118192 Nov  6  2016 /usr/sbin/useradd
-rwxr-x--- 1 root root  80360 Nov  6  2016 /usr/sbin/userdel
-rwxr-x--- 1 root root 113840 Nov  6  2016 /usr/sbin/usermod
-rwsr-xr-x 1 root root  11296 Apr 13  2017 /usr/sbin/usernetctl

[root@ruozedata001 ~]# ll /usr/sbin/group*
-rwxr-x--- 1 root root 65480 Nov  6  2016 /usr/sbin/groupadd
-rwxr-x--- 1 root root 57016 Nov  6  2016 /usr/sbin/groupdel
-rwxr-x--- 1 root root 57064 Nov  6  2016 /usr/sbin/groupmems
-rwxr-x--- 1 root root 76424 Nov  6  2016 /usr/sbin/groupmod

[root@ruozedata001 ~]# useradd xx  创建用户的同时也创建一个用户组xx
[root@ruozedata001 ~]# id xx
uid=1006(xx) gid=1007(xx) groups=1007(xx)

[root@ruozedata001 ~]# cat /etc/passwd
xx:x:1006:1007::/home/xx:/bin/bash
 该用户进入Linux命令窗口，命令解释器？
[root@ruozedata001 ~]# cat /etc/group
xx:x:1007:

切换用户
[root@ruozedata001 ~]# su - xx
[xx@ruozedata001 ~]$ exit
logout
[root@ruozedata001 ~]# pwd
/root
[root@ruozedata001 ~]# su xx
[xx@ruozedata001 root]$ pwd
/root
[xx@ruozedata001 root]$ cd
[xx@ruozedata001 ~]$ 
[xx@ruozedata001 ~]$ pwd
/home/xx

[root@ruozedata001 ~]# userdel xx
删除用户，那么该用户所属的用户组假如没有其他用户，则一起删除；否则有其他用户就被删除不了。

样式丢失
[root@ruozedata001 ~]# useradd xx
  模拟不存在
[root@ruozedata001 ~]# rm -f /home/xx/.bash*

一个用户默认创建的家目录是在 /home/用户名，但是后期可以修改
[root@ruozedata001 ~]# usermod -d /tmp  xx
[root@ruozedata001 ~]# su - xx
Last login: Sun Nov  8 20:47:29 CST 2020 on pts/0
-bash-4.2$ 
-bash-4.2$ 
-bash-4.2$ pwd
/tmp
-bash-4.2$ 

[root@ruozedata001 ~]# su - xx
Last login: Sun Nov  8 20:44:10 CST 2020 on pts/0
-bash-4.2$ 
-bash-4.2$ 

当前用户的所属家目录的 个人环境变量文件不存在

-bash-4.2$ cp /etc/skel/.* /home/xx/
cp: omitting directory ‘/etc/skel/.’
cp: omitting directory ‘/etc/skel/..’
-bash-4.2$ exit
logout
[root@ruozedata001 ~]# su - xx
Last login: Sun Nov  8 20:44:58 CST 2020 on pts/0
[xx@ruozedata001 ~]$ ll -a
total 16
drwx------  2 xx   xx79 Nov  8 20:47 .
drwxr-xr-x. 9 root root  85 Nov  8 20:43 ..
-rw-------  1 xx   xx31 Nov  8 20:47 .bash_history
-rw-r--r--  1 xx   xx18 Nov  8 20:47 .bash_logout
-rw-r--r--  1 xx   xx   193 Nov  8 20:47 .bash_profile
-rw-r--r--  1 xx   xx   231 Nov  8 20:47 .bashrc
[xx@ruozedata001 ~]$ 

添加用户到新的用户组

主组 其他组
[root@ruozedata001 ~]# usermod -a -G dw  xx
[root@ruozedata001 ~]# id xx
uid=1006(xx) gid=1007(xx) groups=1007(xx),1008(dw)
[root@ruozedata001 ~]# usermod -g dw xx
[root@ruozedata001 ~]# id xx
uid=1006(xx) gid=1008(dw) groups=1008(dw)
[root@ruozedata001 ~]# usermod -a -G xx xx
[root@ruozedata001 ~]# id xx
uid=1006(xx) gid=1008(dw) groups=1008(dw),1007(xx)

[root@ruozedata001 ~]# groupmems -g xx -l
xx </code></pre>
<blockquote>
<p>3.passwd文件</p>
</blockquote>
<pre><code>xx:x:1006:1008::/tmp:/sbin/nologin
This account is currently not available.
xx:x:1006:1008::/tmp:/bin/false
[root@ruozedata001 ~]# su - xx
Last login: Sun Nov  8 21:10:48 CST 2020 from 121.235.15.179 on pts/3
CDH部署，hdfs hbase等等用户，su - hdfs切不过去的，原因就在  /bin/false
jps命令查看都是 不可用的
su - hdfs 之前 将/bin/false 改为 /bin/bash 即可切换成功。</code></pre>
<blockquote>
<p>4.su sudo</p>
</blockquote>
<pre><code>su xx 切换用户
su - xx 切换用户 进入家目录 且执行该用户环境变量文件 .bashrc

sudo 普通用户临时使用root的最大权限
[root@ruozedata001 ~]# su - xx
Last login: Sun Nov  8 21:17:16 CST 2020 on pts/3
-bash-4.2$ cat /root/rz.txt
cat: /root/rz.txt: Permission denied【错误2】 没有权限
-bash-4.2$ 

配置xx用户是有sudo权限的
[root@ruozedata001 ~]# vi /etc/sudoers
xx ALL=(root)  NOPASSWD:ALL


[root@ruozedata001 ~]# su -  xx
Last login: Sun Nov  8 21:17:41 CST 2020 on pts/3
-bash-4.2$ 
-bash-4.2$ cat /root/rz.txt
cat: /root/rz.txt: Permission denied
-bash-4.2$ 
-bash-4.2$ sudo cat /root/rz.txt
www.ruozedata.com
-bash-4.2$ 

生产场景：用户的权限不满足需求，需要更高的，假如IT 和公司管理制度都还好，就要求加sudo权限。
否则碰见这种权限错误的操作，只能让对应的IT人员操作。</code></pre>
<blockquote>
<p>5.权限</p>
</blockquote>
<pre><code>[root@ruozedata001 ~]# ll
total 8
drwxr-xr-x 2 root root   6 Nov  8 21:35 dir1
-rw-r--r-- 1 root root 551 Nov  8 21:35 ruoze2.log
-rw-r--r-- 1 root root   0 Nov  8 21:18 ruoze.log
-rw-r--r-- 1 root root  18 Nov  8 21:16 rz.txt

d rwx r-x r-x
- rw- r-- r--
第一个字符 d 代表文件夹 -文件

-rw-r--r-- 1 root root   0 Nov  8 21:18 ruoze.log
接下来三组的 三个字母 分别是代表 读r 4 、写w  2 、执x 1、-没有任何权限 0
第一组： rw-  文件或者文件夹的所属用户，只有读写权限，没有执行权限
第二组： r--  文件或者文件夹的所属用户组的成员，只有读
第三组： r--  其他用户组的成员对这个文件或文件夹的权限，只有读

rw- r-- r-- ==》 644

未来给出一个数字，你们能够迅速反应出对应的权限
比如：
777  rwxrwxrwx
755  rwxr-xr-x
640  rw-r-----
600  rw-------

[root@ruozedata001 tmp]# ll 
-rw-r--r-- 1 root   root   18 Nov  8 21:47 ruoze.log

[root@ruozedata001 tmp]# chmod 640 ruoze.log 
-rw-r----- 1 root   root   18 Nov  8 21:47 ruoze.log
[root@ruozedata001 tmp]# su - xx
-bash-4.2$ cat /tmp/ruoze.log 
cat: /tmp/ruoze.log: Permission denied</code></pre>
<blockquote>
<p>6.权限命令</p>
</blockquote>
<pre><code>chmod -R 777   文件或者文件夹
chown -R 用户:用户组   文件或者文件夹

-rw-r--r-- 1 root   root   18 Nov  8 21:47 ruoze.log

[root@ruozedata001 tmp]# chown xx:xx ruoze.log
[root@ruozedata001 tmp]# ll
-rw-r--r-- 1 xx xx 18 Nov  8 21:47 ruoze.log</code></pre>
<blockquote>
<p>7.大小</p>
</blockquote>
<pre><code>文件大小： ll -h
文件或文件夹大小 ： du -sh
[root@ruozedata001 ~]# 
[root@ruozedata001 ~]# du -sh /usr/local
11G /usr/local</code></pre>
<blockquote>
<p>8.搜索  find</p>
</blockquote>
<pre><code>[root@ruozedata001 ~]# find / -name &#39;*hadoop*&#39;
[root@ruozedata001 ~]# find /home/ -name &#39;*hadoop*&#39;

history 去看看常规操作在哪里 蛛丝马迹
find 搜索 
ps -ef 查看进程</code></pre>
<blockquote>
<p>9.vi 编辑</p>
</blockquote>
<pre><code>【良好习惯】：
vi 编辑生产配置文件 
先 cp conf  conf20201108
vi 敲完 wq也保存，也不怕

进入提示是 swap文件，只需ll -a查看，进行删除即可
E325: ATTENTION
Found a swap file by the name &quot;.rz.txt.swp&quot;
owned by: root   dated: Sun Nov  8 22:17:56 2020
file name: ~root/rz.txt

粘贴的坑:
必须进入编辑模式 ，否则第一行内容丢失 不完整 【生产具坑】

在命令行模式，常用的快捷方式:
dd  删除当前行 【常用】
dG  删除当前行及以下所有行 【常用】
ndd 删除当前行及以下n-1行
gg 跳转到第一行的第一个字母
G  跳转到最后一行的第一个字母
shift+$ 行尾

如何通过vi命令进行清空文件内容：
gg dG

生产场景：window电脑的服务的配置文件内容修改过 最新的，想要覆盖生产的文件
gg dG
i 
从window电脑拷贝全局内容到Linux的会话编辑模式中，按鼠标的右键 粘贴 
esc
shfit+:  wq
行号：尾行模式 set nu
去掉行号：set nonu</code></pre>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article id="post-yum源搭建" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2020-11-06T13:12:37.878Z"><a href="/2020/11/06/yum%E6%BA%90%E6%90%AD%E5%BB%BA/">2020-11-06</a></time>
      
      
  
    <h1 class="title"><a href="/2020/11/06/yum%E6%BA%90%E6%90%AD%E5%BB%BA/">yum源搭建</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <h2 id="1-搭建局域网yum源"><a href="#1-搭建局域网yum源" class="headerlink" title="1.搭建局域网yum源"></a>1.搭建局域网yum源</h2><blockquote>
<p>1.首先部署web环境<br>2.在/var/www/html下创建iso<br>3.mount -o loop 镜像文件 /vat/www/html/iso<br>4.在/etc/yum.repos.d/下新建repo文件<br>[network]<br>name=network<br>baseurl=<a target="_blank" rel="noopener" href="http://192.168.244.113/iso">http://192.168.244.113/iso</a><br>enabled=1<br>gpgcheck=0<br>5.yum clean all<br>yum makecache</p>
</blockquote>
<h2 id="2-搭建本地yum源"><a href="#2-搭建本地yum源" class="headerlink" title="2.搭建本地yum源"></a>2.搭建本地yum源</h2><blockquote>
<p>1.mount /dev/sr0 /mnt<br>2.在/etc/yum.repos.d/下新建repo文件<br>[local]<br>name=local<br>baseurl=file:///mnt<br>enabled=1<br>gpgcheck=0<br>3.yum clean all<br> yum makecache</p>
</blockquote>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article id="post-Centos7最小化安装图形界面(GNOME)" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2020-11-06T11:34:12.436Z"><a href="/2020/11/06/Centos7%E6%9C%80%E5%B0%8F%E5%8C%96%E5%AE%89%E8%A3%85%E5%9B%BE%E5%BD%A2%E7%95%8C%E9%9D%A2(GNOME)/">2020-11-06</a></time>
      
      
  
    <h1 class="title"><a href="/2020/11/06/Centos7%E6%9C%80%E5%B0%8F%E5%8C%96%E5%AE%89%E8%A3%85%E5%9B%BE%E5%BD%A2%E7%95%8C%E9%9D%A2(GNOME)/">Centos7最小化安装图形界面(GNOME)</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <blockquote>
<p>最开始准备阶段的mount本地镜像或者网络yum源的方式不再赘述<br>1.安装图形软件界面Gnome ##</p>
</blockquote>
<pre><code>[root@VM-0-2-centos ~]# yum groupinstall &quot;GNOME Desktop&quot; //相反卸载命令为yum groupremove &quot;GNOME Desktop&quot;</code></pre>
<blockquote>
<p>2.安装X Window System</p>
</blockquote>
<pre><code>[root@VM-0-2-centos ~]#yum groupinstall &quot;X Window System&quot;  //相反卸载命令为yum groupremove&quot;X Window System&quot; </code></pre>
<blockquote>
<p>3.在执行完上述两个步骤之后，此时系统还处于默认为最小化模式运行，此时要改为图形化模式为默认</p>
</blockquote>
<pre><code>ln -sf /lib/systemd/system/graphical.target /etc/systemd/system/default.targe</code></pre>
<blockquote>
<p>另再附上图形化改回最小化方式</p>
</blockquote>
<pre><code>ln -sf /lib/systemd/system/multi-user.target /etc/systemd/system/default.targe
或者直接用命令修改
systemctl set-default graphical.target
systemctl set-default multi-user.target
reboot重启即可</code></pre>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article id="post-Centos7部署安装VNC服务" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2020-11-06T11:27:57.577Z"><a href="/2020/11/06/Centos7%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85VNC%E6%9C%8D%E5%8A%A1/">2020-11-06</a></time>
      
      
  
    <h1 class="title"><a href="/2020/11/06/Centos7%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85VNC%E6%9C%8D%E5%8A%A1/">Centos7部署VNC</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <p>最开始准备阶段的mount本地镜像或者网络yum源的方式以及安装图形化界面的方式不再赘述 安装图形化界面可参考我的另一篇文章<a href="https://qidimangu.github.io/2020/11/06/Centos7%E6%9C%80%E5%B0%8F%E5%8C%96%E5%AE%89%E8%A3%85%E5%9B%BE%E5%BD%A2%E7%95%8C%E9%9D%A2(Gnome)/">https://qidimangu.github.io/2020/11/06/Centos7%E6%9C%80%E5%B0%8F%E5%8C%96%E5%AE%89%E8%A3%85%E5%9B%BE%E5%BD%A2%E7%95%8C%E9%9D%A2(Gnome)/</a></p>
<blockquote>
<p>1.关闭防火墙(iptables firewalld)以及内核防火墙</p>
</blockquote>
<pre><code>[root@localhost ~]# systemctl stop firewalld
[root@localhost ~]#iptables -F
[root@localhost ~]# setenforce 0
建议内核防火墙直接禁用,修改:/etc/selinux/config中SELINUX=disabled</code></pre>
<blockquote>
<p>2.修改当前默认的启动模式为图形化模式</p>
</blockquote>
<pre><code>[root@localhost ~]# systemctl set-default graphical.target </code></pre>
<blockquote>
<p>3.用此命令验证当前的系统默认能启动模式</p>
</blockquote>
<pre><code>[root@localhost ~]# systemctl get-default graphical.target</code></pre>
<blockquote>
<p>4.安装VNC服务</p>
</blockquote>
<pre><code>[root@localhost ~]# yum install tigervnc-server tigervnc vnc vnc-server`</code></pre>
<blockquote>
<p>5.配置VNC</p>
</blockquote>
<pre><code>[root@localhost ~]# cp /lib/systemd/system/vncserver@.service /etc/systemd/system/vncserver@:1.service

修改/etc/systemd/system/vncserver@:1.service
ExecStart=/sbin/runuser -l &lt;USER&gt; -c &quot;/usr/bin/vncserver %i&quot;
PIDFile=/home/&lt;USER&gt;/.vnc/%H%i.pid

如果用root用户登录则修改为：
ExecStart=/sbin/runuser -l root -c &quot;/usr/bin/vncserver %i&quot;
PIDFile=/root/.vnc/%H%i.pid
如果是一般用户例test
ExecStart=/sbin/runuser -l test -c &quot;/usr/bin/vncserver %i&quot;
PIDFile=/home/test/.vnc/%H%i.pid</code></pre>
<blockquote>
<p>6.配置远程连接VNC服务时所输入的密码（此处配置为test123456）</p>
</blockquote>
<pre><code>[root@localhost ~]# vncpasswd
password:
verify:
Would you like to enter a view-only password (y/n)? n //注意表示&quot;是否输入一个只能查看的密码，选择否&quot;,否则连接vnc会出现黑屏
[root@localhost ~]# vim /etc/libvirt/qemu.conf (此步骤可有可无，默认的配置文件放开即可)
vnc_password = &quot;123456&quot;
vnc_listen = &quot;0.0.0.0&quot;


7.加载


[root@localhost ~]# systemctl daemon-reload</code></pre>
<blockquote>
<p>8.启动VNC服务</p>
</blockquote>
<pre><code>[root@localhost ~]# systemctl start vncserver@:1.service</code></pre>
<blockquote>
<p>9.关闭一个VNC连接</p>
</blockquote>
<pre><code>[root@localhost ~]# /usr/bin/vncserver -kill :1</code></pre>
<blockquote>
<p>10.测试连接</p>
</blockquote>
<pre><code>注：默认的端口是5901
windows版本的地址：`https://www.realvnc.com/download/file/viewer.files/VNC-Viewer-6.20.113-Windows.exe`</code></pre>
<blockquote>
<p>11.调屏幕分辨率的方法(此处将分辨率调味800 x 600)</p>
</blockquote>
<pre><code>[root@localhost ~]# vncserver -geometry 800x600
或者修改/usr/bin/vncserver 此文件的$geometry = &quot;800x600&quot; 即可；</code></pre>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article id="post-Centos7同步阿里yum仓库搭建yum私有仓库" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2020-11-06T11:15:32.215Z"><a href="/2020/11/06/Centos7%E5%90%8C%E6%AD%A5%E9%98%BF%E9%87%8Cyum%E4%BB%93%E5%BA%93%E6%90%AD%E5%BB%BAyum%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93/">2020-11-06</a></time>
      
      
  
    <h1 class="title"><a href="/2020/11/06/Centos7%E5%90%8C%E6%AD%A5%E9%98%BF%E9%87%8Cyum%E4%BB%93%E5%BA%93%E6%90%AD%E5%BB%BAyum%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93/">Centos7同步阿里yum仓库搭建yum私有仓库</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <h2 id="一、准备"><a href="#一、准备" class="headerlink" title="一、准备"></a>一、准备</h2><blockquote>
<p>确认在预拉取yum包的机子关于网络的各项服务正常，拉取的过程对网路的要求挺高，今天用50M宽带拉取大概5个多小时。另在拉取的机子上配置好阿里的base源和epel源。</p>
</blockquote>
<p>1.修改yum源仓库</p>
<pre><code>[root@mini2 /]# rm -rf /etc/yum.repos.d/*
[root@mini2 /]# wget -O /etc/yum.repos.d/base.repo http://mirrors.aliyun.com/repo/Centos-7.repo   //base源
[root@mini2 /]# wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo        //扩展源
[root@mini2 /]# yum clean all
[root@mini2 /]# yum makecache</code></pre>
<blockquote>
<p>以上为阿里开放的基本源和扩展源，根据需求程度自己拉取<br>2.用yum repolist检查本机连接的源库是否正常，若是正常会出现每个源的明细信息<br>3.安装软件(若安装直接进行下一步)</p>
</blockquote>
<pre><code>[root@mini2 /]#  yum install -y yum-utils createrepo wget make cmake gcc gcc-c++ pcre-devel zlib-devel openssl openssl-devel </code></pre>
<blockquote>
</blockquote>
<h2 id="二、拉取"><a href="#二、拉取" class="headerlink" title="二、拉取"></a>二、拉取</h2><blockquote>
<p> 1.创建源拉取之后存放的目录</p>
</blockquote>
<pre><code> [root@mini2 /]# mkdir -p /var/www/html/mirrors</code></pre>
<blockquote>
<p> 2.拉取远端至本地</p>
</blockquote>
<pre><code> [root@mini2 /]#  reposync -p  /var/www/html/mirrors</code></pre>
<blockquote>
<p> 3.更新最新的yum仓库中的rpm包(此步可省略，因为上步已经拉取到了最新的)</p>
</blockquote>
<pre><code> [root@mini2 /]# reposync -np  /var/www/html/mirrors</code></pre>
<h2 id="三、创建元数据索引"><a href="#三、创建元数据索引" class="headerlink" title="三、创建元数据索引"></a>三、创建元数据索引</h2><pre><code> [root@mini2 /]# createrepo -po /var/www/html/mirrors/base/  /var/www/html/mirrors/base/
 [root@mini2 /]# createrepo -po /var/www/html/mirrors/extras/  /var/www/html/mirrors/extras/
 [root@mini2 /]# createrepo -po /var/www/html/mirrors/updates/  /var/www/html/mirrors/updates/
 [root@mini2 /]# createrepo -po /var/www/html/mirrors/epel/  /var/www/html/mirrors/epel/</code></pre>
<h2 id="四、更新元数据索引"><a href="#四、更新元数据索引" class="headerlink" title="四、更新元数据索引"></a>四、更新元数据索引</h2><p>此步是增量更新rpm包之后执行更新元数据索引的，重复执行上步也可只不过全量数据较大，考验处理器计算能力） </p>
<pre><code> [root@mini2 /]# createrepo --update   /var/www/html/mirrors/base
 [root@mini2 /]# createrepo --update   /var/www/html/mirrors/extras
 [root@mini2 /]# createrepo --update   /var/www/html/mirrors/updates
 [root@mini2 /]# createrepo --update   /var/www/html/mirrors/epel</code></pre>
<h2 id="五、发布（推荐使用nginx）"><a href="#五、发布（推荐使用nginx）" class="headerlink" title="五、发布（推荐使用nginx）"></a>五、发布（推荐使用nginx）</h2><pre><code>[root@mini2 /]# yum install nginx -y
[root@mini2 /]# vim /etc/nginx/nginx.conf
编辑其中的根目录定位至 /var/www/html/mirrors #若是找不到nginx的安装目录使用rpm -ql nginx 查找nginx安装文件的目录文件</code></pre>
<h2 id="六、编写repo文件发布给客户端"><a href="#六、编写repo文件发布给客户端" class="headerlink" title="六、编写repo文件发布给客户端"></a>六、编写repo文件发布给客户端</h2><pre><code>[root@mini2 /]# vim /etc/yum.repos.d/Centos7-Base.repo

[base]
name=base - mirror.qidi.com
baseurl=http://192.168.0.106/base/
enabled=1
gpgcheck=0

[updates]
name=updates - mirror.qidi.com
baseurl=http://192.168.0.106/updates/
enabled=1
gpgcheck=0

[extras]
name=extras - mirrors.qidi.com
baseurl=http://192.168.0.106/extras/
enabled=1
gpgcheck=0

[epel]
name=epel - mirrors.qidi.com
baseurl=http://192.168.0.106/epel/
failovermethod=priority
enabled=1
gpgcheck=0</code></pre>
<h2 id="七、定时同步"><a href="#七、定时同步" class="headerlink" title="七、定时同步"></a>七、定时同步</h2><blockquote>
<p>算了不会写  跳过吧<br>原理还是前边的reposync -np  /var/www/html/mirrors先更新 再update元数据索引<br>    [root@mini2 /]# createrepo –update   /var/www/html/mirrors/base<br>    [root@mini2 /]# createrepo –update   /var/www/html/mirrors/extras<br>    [root@mini2 /]# createrepo –update   /var/www/html/mirrors/updates<br>    [root@mini2 /]# createrepo –update   /var/www/html/mirrors/epel</p>
</blockquote>
<h2 id="八、过程中的错误"><a href="#八、过程中的错误" class="headerlink" title="八、过程中的错误"></a>八、过程中的错误</h2><blockquote>
<ol>
<li>你家网速要不错，不然很多包失败等一次拉完之后需要第二次重新拉取，第二次拉去不会重复拉取</li>
<li>一直心心念的清空iptables规则，关闭firewalld，别忘了还有非常重要的一个内核防火墙setenforce 0一下</li>
<li>足够耐心<del>~</del></li>
</ol>
</blockquote>
<h2 id="九、其他问题"><a href="#九、其他问题" class="headerlink" title="九、其他问题"></a>九、其他问题</h2><blockquote>
<p>这篇文章只涉及Centos7版本，真正的生产环境中不仅仅只有单纯7的yum仓库，其他版本的也有。先放一个阿里源里边写baseurl的格式自己可以复制到浏览器上打开体会一下：<a target="_blank" rel="noopener" href="http://mirrors.aliyun.com/centos/$releasever/os/$basearch/%EF%BC%8Creleaserver%E5%8F%98%E9%87%8F%E6%98%AF%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%89%88%E6%9C%AC%EF%BC%8Cbasearch%E5%8F%98%E9%87%8F%E8%AF%B4%E7%9A%84%E6%98%AF%E6%9E%B6%E6%9E%84">http://mirrors.aliyun.com/centos/$releasever/os/$basearch/，releaserver变量是操作系统的版本，basearch变量说的是架构</a><del>~</del></p>
</blockquote>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article id="post-web服务器部署证书" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2020-11-06T11:04:22.685Z"><a href="/2020/11/06/web%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2%E8%AF%81%E4%B9%A6/">2020-11-06</a></time>
      
      
  
    <h1 class="title"><a href="/2020/11/06/web%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2%E8%AF%81%E4%B9%A6/">web服务器部署证书</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <blockquote>
<p>本文将对Nginx/Tengine，Apache，Tomcat的服务器安装证书方式予以描述，本文将以在腾讯服务器服务器上购买的证书为例，所使用的环境均是Centos 7，另证书名称为<a target="_blank" rel="noopener" href="http://www.example.com为例/">www.example.com为例</a></p>
</blockquote>
<h2 id="一、Nginx服务器证书安装"><a href="#一、Nginx服务器证书安装" class="headerlink" title="一、Nginx服务器证书安装"></a>一、Nginx服务器证书安装</h2><blockquote>
<p>1.进入到nginx.conf文件所在的conf文件夹，本服务器c操作是是：cd /usr/local/openresty/nginx/conf<br>2.将在腾讯获取的证书文件1_<a target="_blank" rel="noopener" href="http://www.example.com_bundle.crt私钥文件2_www.example.com.key文件拷贝到cong所在的文件夹下/">www.example.com_bundle.crt私钥文件2_www.example.com.key文件拷贝到cong所在的文件夹下</a><br>3.配置nginx.conf文件</p>
</blockquote>
<pre><code>server &#123;
 #SSL 访问端口号为 443
 listen 443 ssl; 
 #填写绑定证书的域名
 server_name www.example.com; 
 #证书文件名称
 ssl_certificate 1_www.example.com_bundle.crt; 
 #私钥文件名称
 ssl_certificate_key 2_www.example.com.key; 
 ssl_session_timeout 5m;
 #请按照以下协议配置
 ssl_protocols TLSv1 TLSv1.1 TLSv1.2; 
 #请按照以下套件配置，配置加密套件，写法遵循 openssl 标准。
 ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE; 
 ssl_prefer_server_ciphers on;
 location / &#123;
#网站主页路径。此路径仅供参考，具体请您按照实际目录操作。
 root/home/nginx-rtmp-module-master/test/www; 
 index  index.html index.htm;
 &#125;
&#125;

--------以下配置为将http请求自动跳转至https------
server &#123;
    listen 80;
    #填写绑定证书的域名
    server_name www.example.com; 
    #把http的域名请求转成https
    return 301 https://$host$request_uri; 
&#125;</code></pre>
<blockquote>
<p>还有在nginx的配置里边若是配置了http自动跳转https则需要把在原来在http上配置的内容剪切到https的部分，注意是剪切，比如定义路径的那些东东。</p>
<p>4.检查nginx配置文件，重启服务</p>
</blockquote>
<pre><code>[root@Aliyun ~]# nginx -t
[root@Aliyun ~]# nginx -s reload</code></pre>
<h2 id="二、Apache服务器证书安装"><a href="#二、Apache服务器证书安装" class="headerlink" title="二、Apache服务器证书安装"></a>二、Apache服务器证书安装</h2><blockquote>
<p>1.新建目录，将证书文件放进去</p>
</blockquote>
<pre><code>[root@Aliyun ~]# mkdir /etc/httpd/ssl  （如果有就不用新建）</code></pre>
<blockquote>
<p>2.在 /etc/httpd/conf 目录下的 httpd.conf 配置文件找到 Include conf.modules.d/*.conf 去掉前边的#号<br>3.安装ssl模块</p>
</blockquote>
<pre><code>[root@Aliyun ~]# yum install mod_ssl</code></pre>
<blockquote>
<p>4.在 /etc/httpd/conf.modules.d 目录下的 00-ssl.conf 配置文件找到 LoadModule ssl_module modules/mod_ssl.so 去掉前边的#号<br>5.修改etc/httpd/conf.d/ssl.conf中的如下内容</p>
</blockquote>
<pre><code>&lt;VirtualHost 0.0.0.0:443&gt;
 DocumentRoot &quot;/var/www/html&quot; 
 #填写证书名称
 ServerName www.example.com 
 #启用 SSL 功能
 SSLEngine on 
 #证书文件的路径
 SSLCertificateFile /etc/httpd/ssl/2_www.example.com.crt 
 #私钥文件的路径
 SSLCertificateKeyFile /etc/httpd/ssl/3_www.example.com.key 
 #证书链文件的路径
 SSLCertificateChainFile /etc/httpd/ssl/1_root_bundle.crt 
&lt;/VirtualHost&gt;</code></pre>
<blockquote>
<p>6.http请求自动跳转至https</p>
<p>   1）编辑 /etc/httpd/conf 目录下的 httpd.conf<br>   查找该配置文件中是否存在LoadModule rewrite_module modules/mod_rewrite.so 若有，去掉其前边的#号注释；若不存在则在/etc/httpd/conf.modules.d/的目录下新建00-rewrite.conf文件，并在里边加入LoadModule rewrite_module modules/mod_rewrite.so<br>   2）在/etc/httpd/conf/httpd.conf中添加以下内容 </p>
</blockquote>
<pre><code>&lt;Directory &quot;/var/www/html&quot;&gt; 
# 新增
RewriteEngine on
RewriteCond %&#123;SERVER_PORT&#125; !^443$
RewriteRule ^(.*)?$ https://%&#123;SERVER_NAME&#125;%&#123;REQUEST_URI&#125; [L,R]
&lt;/Directory&gt;</code></pre>
<blockquote>
<p>7.重启服务进行验证</p>
</blockquote>
<h2 id="三、Tomcat服务器证书安装"><a href="#三、Tomcat服务器证书安装" class="headerlink" title="三、Tomcat服务器证书安装"></a>三、Tomcat服务器证书安装</h2><blockquote>
<p>1.将<a target="_blank" rel="noopener" href="http://www.example.com.jks密钥库文件从本地目录拷贝至/tomcat9/conf/%E7%9B%AE%E5%BD%95%E4%B8%8B">www.example.com.jks密钥库文件从本地目录拷贝至/tomcat9/conf/目录下</a><br>2.编辑/tomcat9/conf/server.xml文件，添加以下内容：（定义加密之后访问的端口是8443）</p>
</blockquote>
<pre><code>&lt;Connector port=&quot;8443&quot; protocol=&quot;HTTP/1.1&quot; SSLEnabled=&quot;true&quot;
maxThreads=&quot;150&quot; scheme=&quot;https&quot; secure=&quot;true&quot;
#证书保存的路径
keystoreFile=&quot;/tomcat/conf/www.example.com.jks&quot; 
#密钥库密码
keystorePass=&quot;******&quot;   #注意密码两侧有双引号
clientAuth=&quot;false&quot;/&gt;
其中clientAuth参数：如果设为 true，表示 Tomcat 要求所有的 SSL 客户出示安全证书，对 SSL 客户进行身份验证。</code></pre>
<blockquote>
<p>3.启动服务</p>
</blockquote>
<pre><code>[root@Aliyun  bin]# ./startup.sh</code></pre>
<blockquote>
<p>————-以上已经配置好证书已经可以使用，以下为配置http自动跳转至https（可选）—————-</p>
<p>4.编辑/tomcat9/conf/web.xml文件，在《/welcome-file-list》标签下边换行添加：</p>
</blockquote>
<pre><code>&lt;login-config&gt;
 &lt;!-- Authorization setting for SSL --&gt;
 &lt;auth-method&gt;CLIENT-CERT&lt;/auth-method&gt;
 &lt;realm-name&gt;Client Cert Users-only Area&lt;/realm-name&gt;
 &lt;/login-config&gt;
 &lt;security-constraint&gt;
 &lt;!-- Authorization setting for SSL --&gt;
 &lt;web-resource-collection&gt;
 &lt;web-resource-name&gt;SSL&lt;/web-resource-name&gt;
 &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
 &lt;/web-resource-collection&gt;
 &lt;user-data-constraint&gt;
 &lt;transport-guarantee&gt;CONFIDENTIAL&lt;/transport-guarantee&gt;
 &lt;/user-data-constraint&gt;
 &lt;/security-constraint&gt;</code></pre>
<blockquote>
<p>5.编辑/tomcat9/conf下的server.xml文件，修改为8443端口:</p>
</blockquote>
<pre><code>&lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot;
connectionTimeout=&quot;20000&quot;
redirectPort=&quot;8443&quot; /&gt;</code></pre>
<blockquote>
<p>6.执行命令检查配置文件是否存在问题</p>
</blockquote>
<pre><code>[root@Aliyun  bin]# ./configtest.sh</code></pre>
<blockquote>
<p>7.启动</p>
</blockquote>
<pre><code>[root@Aliyun  bin]# ./startup.sh</code></pre>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article id="post-proxy" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2020-11-06T10:48:19.625Z"><a href="/2020/11/06/proxy/">2020-11-06</a></time>
      
      
  
    <h1 class="title"><a href="/2020/11/06/proxy/">正向代理</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <h2 id="一、准备"><a href="#一、准备" class="headerlink" title="一、准备"></a>一、准备</h2><p>安装以及准备相关依赖包</p>
<pre><code>[root@Aliyun ~]#  yum -y install  pcre-devel  openssl openssl-devel
[root@Aliyun ~]#  yum -y install lua-devel  git
[root@Aliyun ~]#  wget -c https://openresty.org/download/openresty-1.15.8.1.tar.gz
[root@Aliyun ~]#  git clone https://github.com/chobits/ngx_http_proxy_connect_module.git</code></pre>
<h2 id="二、安装"><a href="#二、安装" class="headerlink" title="二、安装"></a>二、安装</h2><pre><code>[root@Aliyun ~]#  tar -zxvf openresty-1.15.8.1.tar.gz
[root@Aliyun ~]#  vim /root/openresty-1.15.8.1/bundle/nginx-1.15.8/auto/cc/gcc
# 将下列代码注释
# debug
CFLAGS=&quot;$CFLAGS -g&quot;
[root@Aliyun ~]# mv openresty-1.15.8.1  /usr/local/src/
[root@Aliyun ~]# cd openresty-1.15.8.1
[root@Aliyun openresty-1.15.8.1]#  ./configure --prefix=/opt/openresty --with-http_stub_status_module --with-http_sub_module --with-http_auth_request_module --with-http_addition_module --add-module=/usr/local/src/ngx_http_proxy_connect_module
[root@Aliyun openresty-1.15.8.1]# patch -d build/nginx-1.15.8/ -p 1 &lt; /usr/local/src/ngx_http_proxy_connect_module/patch/proxy_connect_rewrite_101504.patch

[root@Aliyun ~]# gmake -j 8 &amp;&amp; gmake install
[root@Aliyun ~]# echo &quot;/opt/openresty/nginx/sbin/nginx&quot; &gt;&gt; /etc/rc.d/rc.local
[root@Aliyun ~]# ln -s /opt/openresty/nginx/sbin/nginx   /usr/sbin/nginx
[root@Aliyun ~]#  nginx   #启动服务</code></pre>
<h2 id="三、配置"><a href="#三、配置" class="headerlink" title="三、配置"></a>三、配置</h2><blockquote>
<p>[root@Aliyun ~]#  vim /opt/openresty/nginx/conf/nginx.conf<br>在server模块中添加如下：<br>server {<br>  listen 80;<br>  resolver 8.8.8.8;<br>  resolver_timeout 5s;<br>  proxy_connect;<br>  proxy_connect_allow 443 563;<br>  proxy_connect_connect_timeout 10s;<br>  proxy_connect_read_timeout 10s;<br>  proxy_connect_send_timeout 10s;<br>  location / {<br>  proxy_pass $scheme://$host$request_uri;<br>  proxy_set_header Host $http_host;<br>  proxy_buffers 256 4k;<br>  proxy_max_temp_file_size 0;<br>  proxy_connect_timeout 30;<br>  }<br> }<br>[root@Aliyun ~]# nginx -t   #检查配置文件是否正确<br>[root@Aliyun ~]# nginx -s reload</p>
</blockquote>
<blockquote>
<p> ps:先把csdn上边的文章搬过来，至于美不美的以后再调吧</p>
</blockquote>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article id="post-hello-world" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2020-11-05T03:19:24.608Z"><a href="/2020/11/05/hello-world/">2020-11-05</a></time>
      
      
  
    <h1 class="title"><a href="/2020/11/05/hello-world/">Hello World</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://qidimangu.github.io/">Myblog</a>! This is your very first post. Check <a href="qidimangu.github.io">documentation</a> for more info. If you get any problems when using Blog, you can find the answer in <a href="https://qidimangu.github.io/">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/qidimangu/Qidimangu.github.io">GitHub</a>.</p>
<blockquote>
<p>感谢Hexo</p>
</blockquote>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





<nav id="pagination">
  
    <a href="/" class="alignleft prev">上一页</a>
  
  
  <div class="clearfix"></div>
</nav></div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="as_sitesearch" value="qidimangu.github.io">
  </form>
</div>


  

  
</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2021 李鹏超
  
</div>
<div class="clearfix"></div></footer>
  
<script src="/js/jquery-3.4.1.min.js"></script>


<script src="/js/jquery.imagesloaded.min.js"></script>


<script src="/js/gallery.js"></script>






<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script src="/fancybox/jquery.fancybox.pack.js"></script>

<script>
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>
