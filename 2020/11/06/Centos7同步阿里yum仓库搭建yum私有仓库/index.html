


<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,inital-scale=1,user-scalable=no">
  <title>Centos7同步阿里yum仓库搭建yum私有仓库 [ 綮地 ]</title>
  <!-- bootstrapcss文件 -->
 <!--  <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"> -->
<!--   
<link rel="stylesheet" href="/css/zhl.css">

 -->
  
    <!-- stylesheets list from config.yml -->
    
      <link rel="stylesheet" href="/css/fork-awesome.min.css">
    
      <link rel="stylesheet" href="/css/zhl.css">
    
  
  
<meta name="generator" content="Hexo 5.2.0"></head>
<body>
<div class="container-fluid">
  <div class="row">
  <div id="wrap" class="col-md-12">
    <div id="header">
	<div id="header-left">
	<h1 id="header-title"> 
	<a href="/">
		綮地
	</a>
	</h1>
	
	</div>
	<div id="header-right">
		
		
		<a href="/"  title="home"><i class="fa fa-home ">home</i></a>
		
		<a target="_blank" rel="noopener" href="https://github.com/lizehongss/demo_show"  title="demo"><i class="fa fa-code ">demo</i></a>
		
		<a href="/about"  title="about"><i class="fa fa-user ">about</i></a>
		
		<a href="/"  title="music"><i class="fa fa-music ">music</i></a>
		
		
	</div>
</div>

  </div>
  </div>
  <div id="content" class="row">
    <div id="content-left" class="col-md-4">
      

	

	

	
	<div class="widget-wrap">
		<h3 class="widget-title fa fa-archive">归档</h3>
		<div class="widget">
			<ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">2020</a><span class="archive-list-count">18</span></li></ul>
		</div>
	</div>



    </div>
    <div id="content-right" class="col-md-8">
    
<article id="post">
	<div class="post-title">
  <h1>Centos7同步阿里yum仓库搭建yum私有仓库</h1>
  	</div>
  <div class="page-meta">
  	<span class="fa-wrap">
  		<i class="fa fa-clock-o"></i>
  		<span class="date-meta">2020-11-06</span>
  	</span>
  	<span class="fa-wrap">
  		
  	</span>
  	<span class="fa-wrap">
  		
  	</span>
  </div>
  <div class="post-content">
  <h2 id="一、准备"><a href="#一、准备" class="headerlink" title="一、准备"></a>一、准备</h2><blockquote>
<p>确认在预拉取yum包的机子关于网络的各项服务正常，拉取的过程对网路的要求挺高，今天用50M宽带拉取大概5个多小时。另在拉取的机子上配置好阿里的base源和epel源。</p>
</blockquote>
<p>1.修改yum源仓库</p>
<pre><code>[root@mini2 /]# rm -rf /etc/yum.repos.d/*
[root@mini2 /]# wget -O /etc/yum.repos.d/base.repo http://mirrors.aliyun.com/repo/Centos-7.repo   //base源
[root@mini2 /]# wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo        //扩展源
[root@mini2 /]# yum clean all
[root@mini2 /]# yum makecache</code></pre>
<blockquote>
<p>以上为阿里开放的基本源和扩展源，根据需求程度自己拉取<br>2.用yum repolist检查本机连接的源库是否正常，若是正常会出现每个源的明细信息<br>3.安装软件(若安装直接进行下一步)</p>
</blockquote>
<pre><code>[root@mini2 /]#  yum install -y yum-utils createrepo wget make cmake gcc gcc-c++ pcre-devel zlib-devel openssl openssl-devel </code></pre>
<blockquote>
</blockquote>
<h2 id="二、拉取"><a href="#二、拉取" class="headerlink" title="二、拉取"></a>二、拉取</h2><blockquote>
<p> 1.创建源拉取之后存放的目录</p>
</blockquote>
<pre><code> [root@mini2 /]# mkdir -p /var/www/html/mirrors</code></pre>
<blockquote>
<p> 2.拉取远端至本地</p>
</blockquote>
<pre><code> [root@mini2 /]#  reposync -p  /var/www/html/mirrors</code></pre>
<blockquote>
<p> 3.更新最新的yum仓库中的rpm包(此步可省略，因为上步已经拉取到了最新的)</p>
</blockquote>
<pre><code> [root@mini2 /]# reposync -np  /var/www/html/mirrors</code></pre>
<h2 id="三、创建元数据索引"><a href="#三、创建元数据索引" class="headerlink" title="三、创建元数据索引"></a>三、创建元数据索引</h2><pre><code> [root@mini2 /]# createrepo -po /var/www/html/mirrors/base/  /var/www/html/mirrors/base/
 [root@mini2 /]# createrepo -po /var/www/html/mirrors/extras/  /var/www/html/mirrors/extras/
 [root@mini2 /]# createrepo -po /var/www/html/mirrors/updates/  /var/www/html/mirrors/updates/
 [root@mini2 /]# createrepo -po /var/www/html/mirrors/epel/  /var/www/html/mirrors/epel/</code></pre>
<h2 id="四、更新元数据索引"><a href="#四、更新元数据索引" class="headerlink" title="四、更新元数据索引"></a>四、更新元数据索引</h2><p>此步是增量更新rpm包之后执行更新元数据索引的，重复执行上步也可只不过全量数据较大，考验处理器计算能力） </p>
<pre><code> [root@mini2 /]# createrepo --update   /var/www/html/mirrors/base
 [root@mini2 /]# createrepo --update   /var/www/html/mirrors/extras
 [root@mini2 /]# createrepo --update   /var/www/html/mirrors/updates
 [root@mini2 /]# createrepo --update   /var/www/html/mirrors/epel</code></pre>
<h2 id="五、发布（推荐使用nginx）"><a href="#五、发布（推荐使用nginx）" class="headerlink" title="五、发布（推荐使用nginx）"></a>五、发布（推荐使用nginx）</h2><pre><code>[root@mini2 /]# yum install nginx -y
[root@mini2 /]# vim /etc/nginx/nginx.conf
编辑其中的根目录定位至 /var/www/html/mirrors #若是找不到nginx的安装目录使用rpm -ql nginx 查找nginx安装文件的目录文件</code></pre>
<h2 id="六、编写repo文件发布给客户端"><a href="#六、编写repo文件发布给客户端" class="headerlink" title="六、编写repo文件发布给客户端"></a>六、编写repo文件发布给客户端</h2><pre><code>[root@mini2 /]# vim /etc/yum.repos.d/Centos7-Base.repo

[base]
name=base - mirror.qidi.com
baseurl=http://192.168.0.106/base/
enabled=1
gpgcheck=0

[updates]
name=updates - mirror.qidi.com
baseurl=http://192.168.0.106/updates/
enabled=1
gpgcheck=0

[extras]
name=extras - mirrors.qidi.com
baseurl=http://192.168.0.106/extras/
enabled=1
gpgcheck=0

[epel]
name=epel - mirrors.qidi.com
baseurl=http://192.168.0.106/epel/
failovermethod=priority
enabled=1
gpgcheck=0</code></pre>
<h2 id="七、定时同步"><a href="#七、定时同步" class="headerlink" title="七、定时同步"></a>七、定时同步</h2><blockquote>
<p>算了不会写  跳过吧<br>原理还是前边的reposync -np  /var/www/html/mirrors先更新 再update元数据索引<br>    [root@mini2 /]# createrepo –update   /var/www/html/mirrors/base<br>    [root@mini2 /]# createrepo –update   /var/www/html/mirrors/extras<br>    [root@mini2 /]# createrepo –update   /var/www/html/mirrors/updates<br>    [root@mini2 /]# createrepo –update   /var/www/html/mirrors/epel</p>
</blockquote>
<h2 id="八、过程中的错误"><a href="#八、过程中的错误" class="headerlink" title="八、过程中的错误"></a>八、过程中的错误</h2><blockquote>
<ol>
<li>你家网速要不错，不然很多包失败等一次拉完之后需要第二次重新拉取，第二次拉去不会重复拉取</li>
<li>一直心心念的清空iptables规则，关闭firewalld，别忘了还有非常重要的一个内核防火墙setenforce 0一下</li>
<li>足够耐心<del>~</del></li>
</ol>
</blockquote>
<h2 id="九、其他问题"><a href="#九、其他问题" class="headerlink" title="九、其他问题"></a>九、其他问题</h2><blockquote>
<p>这篇文章只涉及Centos7版本，真正的生产环境中不仅仅只有单纯7的yum仓库，其他版本的也有。先放一个阿里源里边写baseurl的格式自己可以复制到浏览器上打开体会一下：<a target="_blank" rel="noopener" href="http://mirrors.aliyun.com/centos/$releasever/os/$basearch/%EF%BC%8Creleaserver%E5%8F%98%E9%87%8F%E6%98%AF%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%89%88%E6%9C%AC%EF%BC%8Cbasearch%E5%8F%98%E9%87%8F%E8%AF%B4%E7%9A%84%E6%98%AF%E6%9E%B6%E6%9E%84">http://mirrors.aliyun.com/centos/$releasever/os/$basearch/，releaserver变量是操作系统的版本，basearch变量说的是架构</a><del>~</del></p>
</blockquote>

	</div>
</article>



    </div>
  </div>
  <div class="row">
<div id="bottom" class="col-md-12"> 
  <div class="bottom-nav">
	
	
	<a href="https://github.com/lizehongss" class="fa fa-github fa-2x" target="_blank" title="Follow me" ></a>
	
	
</div>
<div class="bottom-info">
	&copy; 2021 李鹏超<br>
	Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
	theme <a href="https://github.com/lizehongss/hexo-theme-zhl" target="_blank">zhl</a>
</div>
</div>
</div>
</div>
<div id="tool">
  <ul>
    <li class="fa fa-angle-up top" id="top"></li>
  </ul>
</div>
  <div class="bg_content">
    <canvas id="canvas"></canvas>
  </div>
  
  <!-- scripts list from theme config.yml -->
  
    <script src="/js/zhl.js"></script>
  
    <script src="/js/bj.js"></script>
  

<!-- jQ cdn  -->
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<!-- bootstrap js cdn-->
<!-- <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script> -->


</body>
</html>
