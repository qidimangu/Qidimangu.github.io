


<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,inital-scale=1,user-scalable=no">
  <title>Presto集群部署 [ 綮地 ]</title>
  <!-- bootstrapcss文件 -->
 <!--  <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"> -->
<!--   
<link rel="stylesheet" href="/css/zhl.css">

 -->
  
    <!-- stylesheets list from config.yml -->
    
      <link rel="stylesheet" href="/css/fork-awesome.min.css">
    
      <link rel="stylesheet" href="/css/zhl.css">
    
  
  
<meta name="generator" content="Hexo 5.2.0"></head>
<body>
<div class="container-fluid">
  <div class="row">
  <div id="wrap" class="col-md-12">
    <div id="header">
	<div id="header-left">
	<h1 id="header-title"> 
	<a href="/">
		綮地
	</a>
	</h1>
	
	</div>
	<div id="header-right">
		
		
		<a href="/"  title="home"><i class="fa fa-home ">home</i></a>
		
		<a target="_blank" rel="noopener" href="https://github.com/lizehongss/demo_show"  title="demo"><i class="fa fa-code ">demo</i></a>
		
		<a href="/about"  title="about"><i class="fa fa-user ">about</i></a>
		
		<a href="/"  title="music"><i class="fa fa-music ">music</i></a>
		
		
	</div>
</div>

  </div>
  </div>
  <div id="content" class="row">
    <div id="content-left" class="col-md-4">
      

	

	

	
	<div class="widget-wrap">
		<h3 class="widget-title fa fa-archive">归档</h3>
		<div class="widget">
			<ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">2020</a><span class="archive-list-count">18</span></li></ul>
		</div>
	</div>



    </div>
    <div id="content-right" class="col-md-8">
    
<article id="post">
	<div class="post-title">
  <h1>Presto集群部署</h1>
  	</div>
  <div class="page-meta">
  	<span class="fa-wrap">
  		<i class="fa fa-clock-o"></i>
  		<span class="date-meta">2020-11-06</span>
  	</span>
  	<span class="fa-wrap">
  		
  	</span>
  	<span class="fa-wrap">
  		
  	</span>
  </div>
  <div class="post-content">
  <blockquote>
<p>老样子先放包的地址：链接：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1U676CujPaD8kfjrkXgj0qQ">https://pan.baidu.com/s/1U676CujPaD8kfjrkXgj0qQ</a><br>提取码：zvy0<br>若此链接访问不了，可以联系我 QQ：2836310921</p>
</blockquote>
<h2 id="一、环境准备"><a href="#一、环境准备" class="headerlink" title="一、环境准备"></a>一、环境准备</h2><h3 id="1-服务角色分布"><a href="#1-服务角色分布" class="headerlink" title="1.服务角色分布"></a>1.服务角色分布</h3><p><img src="https://i.loli.net/2020/11/06/p2iwDAnh8SlExbs.png"></p>
<h3 id="2-安装包"><a href="#2-安装包" class="headerlink" title="2.安装包"></a>2.安装包</h3><p><img src="https://img-blog.csdnimg.cn/20200211172047867.png" alt="在这里插入图片描述"><br>需要在开始的百度网盘拿</p>
<h2 id="二、部署"><a href="#二、部署" class="headerlink" title="二、部署"></a>二、部署</h2><h3 id="1-安装JDK"><a href="#1-安装JDK" class="headerlink" title="1.安装JDK"></a>1.安装JDK</h3><blockquote>
<p>不在详细赘述，需要注意，官网的解释是presto-server-0.229.tar.gz版本要求jdk版本在jdk-6u115及以上，经过实地在生产环境上的测试（jdk-8u45-linux-x64.gz）这个版本是不行的，后来换了这个版本（jdk-8u221-linux-x64.tar.gz）才OK，第一次部署的环境变量最好写到/etc/profile，若存在JDK，环境变量写到对应用户的.bashrc下</p>
</blockquote>
<h3 id="2-安装presto"><a href="#2-安装presto" class="headerlink" title="2.安装presto"></a>2.安装presto</h3><pre><code> 1)新建presto用户，并上传presto-server-0.229.tar.gz到/home/presto/目录下
 useradd presto
 chown -R presto. presto /home/presto
 su – presto
 tar -zxvf presto-server-0.229.tar.gz

2)修改配置文件(172.16.180.12上操作)
# su – presto
$ cd /home/presto/presto-server-0.229
$ mkdir etc
$ cd etc/
$ touch node.properties
$ touch jvm.config
$ touch config.properties
$ touch log.properties
$ mkdir catalog
$ cd catalog
$ touch hive.properties
$ mkdir hive ##将hive的配置文件core-site.xml、hdfs-site.xml上传到此文件下
$ vi hive.properties
    connector.name=hive-hadoop2
    hive.metastore.uri=thrift://172.16.180.4:9083
    hive.config.resources=/home/presto/presto-server-0.229/etc/catalog/hive/core-site.xml,/home/presto/presto-server-0.229/etc/catalog/hive/hdfs-site.xml
:wq保存退出
$ cd ..
$ vi config.properties
coordinator=true
node-scheduler.include-coordinator=true
http-server.http.port=19999
query.max-memory=8GB
query.max-memory-per-node=2GB
discovery-server.enabled=true
discovery.uri=http://172.16.180.12:19999
:wq保存退出
$ vi jvm.config
-server
-Xmx8G
-XX:+UseG1GC
-XX:G1HeapRegionSize=32M
-XX:+UseGCOverheadLimit
:wq保存退出
$ vi log.properties
com.facebook.presto=INFO #输出日志级别
:wq保存退出
$ vi node.properties
node.environment=production
node.id=cgn_presto_coordinator_node1 #节点唯一标识
node.data-dir=/home/presto/presto-server-0.229/data
:wq保存退出
$ exit
# scp -r /home/presto/presto-server-0.229 root@172.16.180.17: /home/presto/
# scp -r /home/presto/presto-server-0.229 root@172.16.180.3: /home/presto/
修改172.16.180.17、172.16.180.3上的config.properties和node.properties，其中config.properties一样，如下：
coordinator=false
http-server.http.port=19999
query.max-memory=8GB
query.max-memory-per-node=2GB
discovery.uri=http://172.16.180.12:19999

172.16.180.17上node.properties如下：
node.environment=production
node.id=cgn_presto_coordinator_node2
node.data-dir=/home/presto/presto-server-0.229/data

172.16.180.3上node.properties如下：
node.environment=production
node.id=cgn_presto_coordinator_node3
node.data-dir=/home/presto/presto-server-0.229/data

3)    在172.16.180.12、172.16.180.17、172.16.180.3上启动presto
$ cd /home/presto/presto-server-0.229/bin
$ ./launcher start
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200211174235531.png)
出现以上信息即为启动成功。
浏览器登录：http://172.16.180.12:19999
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200211174244645.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1N0dWRlbnRfeHg=,size_16,color_FFFFFF,t_70)
4）上传presto-cli-0.229-executable.jar至/home/presto/presto-server-0.229/bin目录下（连接hive数据仓库）
$ cd /home/presto/presto-server-0.229/bin
$ mv presto-cli-0.229-executable.jar presto
$ chmod +x presto
$ vi hive.sh 
./presto --server 172.16.180.12:19999 --catalog hive --schema test
:wq保存退出
$ ./hive.sh</code></pre>
<p><img src="https://img-blog.csdnimg.cn/20200211174801320.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1N0dWRlbnRfeHg=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<blockquote>
<p>连接成功！</p>
</blockquote>
<h3 id="三、错误解决"><a href="#三、错误解决" class="headerlink" title="三、错误解决"></a>三、错误解决</h3><p>1）错误1</p>
<p><img src="https://img-blog.csdnimg.cn/20200211174337863.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1N0dWRlbnRfeHg=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<blockquote>
<p>解决：给config.properties中加入这个参数：query.max-total-memory-per-node=2GB(2GB的值作为参考)<br>   2）若是出现这种错误：（注入构造函数错误，java.lang。无效的内存配置。每个节点的最大查询总内存(2147483648)和堆头空间(644245094)之和不能大于可用堆内存(2147483648)</p>
</blockquote>
<p>  <img src="https://img-blog.csdnimg.cn/20200211174526262.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>解决：修改etc/jvm.config文件的-Xmx2G参数调节大小</p>
</blockquote>

	</div>
</article>



    </div>
  </div>
  <div class="row">
<div id="bottom" class="col-md-12"> 
  <div class="bottom-nav">
	
	
	<a href="https://github.com/lizehongss" class="fa fa-github fa-2x" target="_blank" title="Follow me" ></a>
	
	
</div>
<div class="bottom-info">
	&copy; 2021 李鹏超<br>
	Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
	theme <a href="https://github.com/lizehongss/hexo-theme-zhl" target="_blank">zhl</a>
</div>
</div>
</div>
</div>
<div id="tool">
  <ul>
    <li class="fa fa-angle-up top" id="top"></li>
  </ul>
</div>
  <div class="bg_content">
    <canvas id="canvas"></canvas>
  </div>
  
  <!-- scripts list from theme config.yml -->
  
    <script src="/js/zhl.js"></script>
  
    <script src="/js/bj.js"></script>
  

<!-- jQ cdn  -->
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<!-- bootstrap js cdn-->
<!-- <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script> -->


</body>
</html>
